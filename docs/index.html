<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>NeuroExamReview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --maxw: 1100px; }
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      max-width: var(--maxw); margin: 24px auto; padding: 0 16px; line-height: 1.55;
      color:#111827;
    }
    h1{margin: 0 0 8px}
    h2{margin: 18px 0 8px}
    .embed{margin:16px 0}
    details{margin:18px 0; border:1px solid #e5e7eb; border-radius:10px; padding:10px 12px; background:#fff}
    summary{cursor:pointer; font-weight:700}
    .md{padding:10px 0}
    .muted{color:#6b7280; font-size:.92rem}
    .error{color:#b00020}
    #fillpic iframe {
      width: 100%;
      height: 100vh; /* full screen height */
      border: 2px solid #666;
      border-radius: 8px;
    }
    .row{display:flex; gap:16px; flex-wrap:wrap}
    .col{flex:1 1 460px}
    .bar{display:flex; gap:8px; align-items:center; margin:10px 0}
    button{padding:6px 10px; border:1px solid #d1d5db; border-radius:8px; background:#fff; cursor:pointer}
    button:hover{background:#f3f4f6}

    /* Mobile-friendly for top model iframe */
    .skf-frame-wrap{
      width:100%; height:520px; border-radius:10px; overflow:hidden; background:#000;
      isolation:isolate;
    }
    .skf-frame-wrap iframe{
      width:100%; height:100%; border:0;
      pointer-events:auto; touch-action:manipulation;
    }
    details[open] > summary { position:relative; z-index:1; }
    * { -webkit-tap-highlight-color: transparent; }
    body { overscroll-behavior-y: contain; }

    /* Collapsible cards built from bolded subheadings (no MD edits required) */
    .card-li{
      border:1px solid #e5e7eb; border-radius:10px; background:#f9fafb;
      margin:10px 0; padding:0; overflow:hidden;
    }
    .card-li .li-head{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; padding:10px 12px; cursor:pointer; user-select:none;
      background:#f3f4f6; font-weight:700;
    }
    .card-li .li-head .title{flex:1 1 auto;}
    .card-li .li-body{ padding:10px 12px; display:none; background:#fff }
    .card-li.open .li-body{ display:block; }
    .chev{ font-size:12px; color:#6b7280 }

    /* Keep nested bullets tidy inside cards */
    .card-li ul{ margin:6px 0 6px 18px }

    /* === FIX: Auto-scale Sketchfab iframes to remove black gaps === */
    .skf-embed{
      width:100%;
      aspect-ratio:16/9;
      background:#000;
      border-radius:10px;
      overflow:hidden;
    }
    .skf-embed iframe{
      width:100%;
      height:100%;
      border:0;
      display:block;
    }
  </style>

  <!-- Markdown renderer -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
  <h1>NeuroExamReview</h1>
  <p class="muted">Interactive brain model + collapsible CNS/PNS study maps</p>

  <!-- Top 3D model (BioDigital you selected) -->
  <h2>Brain 3D (interactive model)</h2>
  <div class="embed skf-frame-wrap">
    <iframe
      title="BioDigital Human Viewer"
      src="https://human.biodigital.com/widgets/healthline/?be=3KnN&ui-info=true&ui-search=true&ui-reset=true&ui-fullscreen=true&ui-nav=true&ui-tools=true&ui-help=true&ui-chapter-list=false&ui-label-list=true&ui-anatomy-descriptions=false&disable-scroll=false&uaid=51km3"
      allow="fullscreen; xr-spatial-tracking"
      allowfullscreen
      loading="eager"
      referrerpolicy="strict-origin-when-cross-origin"></iframe>
  </div>

  <!-- Controls -->
  <div class="bar">
    <button onclick="toggleAll(true)">Expand all</button>
    <button onclick="toggleAll(false)">Collapse all</button>
    <button onclick="togglePics()">Useful Pictures</button>
    <button onclick="toggleFillPic()">Fill Picture</button>
    <button onclick="toggleFillTracts()">Fillable Tracts</button>
  </div>

  <!-- Hidden picture section -->
  <div id="pics" style="display:none; margin:16px 0">
    <div style="display:flex; flex-wrap:wrap; gap:16px; justify-content:center">
      <img src="Dorsal Column Pathway.jpg" alt="Dorsal Column Pathway" style="max-width:30%; border:1px solid #ccc; border-radius:8px">
      <img src="Pathway Comparison.jpg" alt="Pathway Comparison" style="max-width:30%; border:1px solid #ccc; border-radius:8px">
      <img src="Ascending Pathway.png" alt="Ascending Pathway" style="max-width:30%; border:1px solid #ccc; border-radius:8px">
    </div>
  </div>

  <!-- Two collapsibles side-by-side on large screens -->
  <div class="row">
    <div class="col">
      <details open id="d-cns">
        <summary>Central Nervous System (CNS) — concept map & notes</summary>
        <div id="cns" class="md"><p class="muted">Loading cns.md…</p></div>
        <p class="muted">Open as its own page: <a href="cns.md">cns.md</a></p>
      </details>
    </div>
    <div class="col">
      <details open id="d-pns">
        <summary>Peripheral Nervous System (PNS) — concept map & notes</summary>
        <div id="pns" class="md"><p class="muted">Loading pns.md…</p></div>
        <p class="muted">Open as its own page: <a href="pns.md">pns.md</a></p>
      </details>
    </div>
  </div>

  <!-- Fill-in recall picture -->
  <div id="fillpic" style="display:none; margin:16px 0; text-align:center">
    <div id="fill-wrap" style="display:flex; gap:16px; justify-content:center; align-items:flex-start">
      <iframe
        id="fill-pdf"
        src="https://mozilla.github.io/pdf.js/web/viewer.html?file=https://kingto89.github.io/NeuroExamReview/Fillable%20Pathway.pdf">
      </iframe>
      <img id="ref-img" src="Dorsal Column Pathway.jpg" 
           alt="Dorsal Column Pathway reference"
           style="width:45%; height:600px; object-fit:contain; border:2px solid #666; border-radius:8px; display:none">
    </div>
    <div style="margin-top:12px">
      <button onclick="lockFillPic()">Lock Answers</button>
      <button onclick="resetFillPic()">Reset Fill</button>
      <button id="refBtn" onclick="toggleReference()">Show Reference</button>
    </div> <!-- closes fillpic -->
  </div>

  <!-- Fill-in recall tracts -->
  <div id="filltracts" style="display:none; margin:16px 0">
    <div id="tracts" class="md"><p class="muted">Loading fillable_tracts.md…</p></div>
    <p class="muted">Open as its own page: <a href="fillable_tracts.md">fillable_tracts.md</a></p>
  </div>

  <!-- ===== Extra 3D models (fixed wrappers) ===== -->
  <details>
    <summary>Extra 3D models (click to expand)</summary>
    <div class="embed skf-embed">
      <iframe title="Detailed Labeled Surface Structures" src="https://sketchfab.com/models/d91080b5af91497b822728c08804f33c/embed?autostart=1&ui_infos=0&ui_watermark=0" allow="autoplay; fullscreen" allowfullscreen loading="lazy"></iframe>
    </div>
    <div class="embed skf-embed">
      <iframe title="Spinal cord lesions &amp; clinical signs &amp; symptoms" src="https://sketchfab.com/models/bf086ab152a94273837b12a1702cf644/embed?autostart=1&ui_infos=0&ui_watermark=0" allow="autoplay; fullscreen" allowfullscreen loading="lazy"></iframe>
    </div>
    <div class="embed skf-embed">
      <iframe title="Cerebral sulci and gyri" src="https://sketchfab.com/models/afe2aed1d91b4b52be3c842a63aa69b1/embed?autostart=1&ui_infos=0&ui_watermark=0" allow="autoplay; fullscreen" allowfullscreen loading="lazy"></iframe>
    </div>
    <div class="embed skf-embed">
      <iframe title="Spinothalamic Tract 10/13/21" src="https://sketchfab.com/models/9754d81f54df426aafa25b3799b5ce65/embed?autostart=1&ui_infos=0&ui_watermark=0" allow="autoplay; fullscreen" allowfullscreen loading="lazy"></iframe>
    </div>
    <div class="embed skf-embed">
      <iframe title="Corticospinal Tract" src="https://sketchfab.com/models/51d7d61024bf4ecb88f85a35f0041960/embed?autostart=1&ui_infos=0&ui_watermark=0" allow="autoplay; fullscreen" allowfullscreen loading="lazy"></iframe>
    </div>
    <div class="embed skf-embed">
      <iframe title="Ascending tracts" src="https://sketchfab.com/models/3d7e233edbb94cd8b9e1b4047bead951/embed?autostart=1&ui_infos=0&ui_watermark=0" allow="autoplay; fullscreen" allowfullscreen loading="lazy"></iframe>
    </div>
    <div class="embed skf-embed">
      <iframe title="Sagittal head section" src="https://sketchfab.com/models/19378ae104f74bb186c3cb9bd90e16f0/embed?autostart=1&ui_infos=0&ui_watermark=0" allow="autoplay; fullscreen" allowfullscreen loading="lazy"></iframe>
    </div>
  </details>

  <script>
    // Top-level expand/collapse helper
    function toggleAll(open){
      document.querySelectorAll('details').forEach(d => d.open = open);
      document.querySelectorAll('.card-li').forEach(card => {
        card.classList.toggle('open', open);
        const chev = card.querySelector('.chev');
        if (chev) chev.textContent = open ? '▲' : '▼';
      });
    }

    // ---- Enhancer functions (full from your original index) ----
    function makeCardFromPair(titleNode, nodesToWrap){
      const card = document.createElement('div');
      card.className = 'card-li';
      const head = document.createElement('div');
      head.className = 'li-head';
      const title = document.createElement('div');
      title.className = 'title';
      title.textContent = titleNode.textContent.trim();
      const chev = document.createElement('span');
      chev.className = 'chev';
      chev.textContent = '▼';
      head.appendChild(title);
      head.appendChild(chev);
      const body = document.createElement('div');
      body.className = 'li-body';
      const insertBefore = nodesToWrap[0];
      insertBefore.parentNode.insertBefore(card, insertBefore);
      card.appendChild(head);
      card.appendChild(body);
      nodesToWrap.forEach(n => body.appendChild(n));
      head.addEventListener('click', () => {
        const open = !card.classList.contains('open');
        card.classList.toggle('open', open);
        chev.textContent = open ? '▲' : '▼';
      });
    }

    function enhanceBulletedCards(container){
      const lis = container.querySelectorAll('ul > li');
      lis.forEach(li => {
        const strong = li.querySelector(':scope > strong');
        if (!strong) return;
        const more = Array.from(li.childNodes).filter(n => {
          if (n === strong) return false;
          if (n.nodeType === 3 && n.textContent.trim() === '') return false;
          return true;
        });
        if (more.length === 0) return;
        const card = document.createElement('div');
        card.className = 'card-li';
        const head = document.createElement('div');
        head.className = 'li-head';
        const title = document.createElement('div');
        title.className = 'title';
        title.textContent = strong.textContent.trim();
        const chev = document.createElement('span');
        chev.className = 'chev';
        chev.textContent = '▼';
        head.appendChild(title);
        head.appendChild(chev);
        const body = document.createElement('div');
        body.className = 'li-body';
        more.forEach(n => body.appendChild(n));
        li.innerHTML = '';
        li.appendChild(card);
        card.appendChild(head);
        card.appendChild(body);
        head.addEventListener('click', () => {
          const open = !card.classList.contains('open');
          card.classList.toggle('open', open);
          chev.textContent = open ? '▲' : '▼';
        });
      });
    }

    function enhanceParagraphHeadingGroups(container){
      const paras = container.querySelectorAll('p > strong:only-child');
      paras.forEach(str => {
        const p = str.parentElement;
        if (p.closest('.card-li')) return;
        const run = [];
        let n = p.nextSibling;
        while (n) {
          if (n.nodeType === 1) {
            if (n.matches('p > strong:only-child, hr, details')) break;
            if (n.matches('p')) {
              const onlyStrong = n.querySelector(':scope > strong:only-child');
              if (onlyStrong) break;
            }
          }
          const next = n.nextSibling;
          run.push(n);
          n = next;
        }
        if (run.length === 0) return;
        makeCardFromPair(str, run);
        p.remove();
      });
    }

    async function loadMD(file, targetId){
      const el = document.getElementById(targetId);
      try {
        const res = await fetch(file, {cache: "no-store"});
        if(!res.ok) throw new Error(res.status + " " + res.statusText);
        const md = await res.text();
        el.innerHTML = marked.parse(md);
        enhanceBulletedCards(el);
        enhanceParagraphHeadingGroups(el);
      } catch (err) {
        el.innerHTML = `<p class="error">Failed to load ${file}: ${err.message}</p>`;
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadMD('./cns.md', 'cns');
      loadMD('./pns.md', 'pns');
      loadMD('./fillable_tracts.md', 'tracts');
    });

    // === NEW FUNCTIONS ADDED ===
    function togglePics(){
      const pics = document.getElementById('pics');
      pics.style.display = (pics.style.display === 'none') ? 'block' : 'none';
      if(pics.style.display === 'block'){
        document.getElementById('fillpic').style.display = 'none';
        document.getElementById('filltracts').style.display = 'none';
      }
    }

    function toggleFillPic(){
      const fill = document.getElementById('fillpic');
      const isHidden = window.getComputedStyle(fill).display === 'none';
      fill.style.display = isHidden ? 'block' : 'none';
      if(isHidden){
        document.getElementById('pics').style.display = 'none';
        document.getElementById('filltracts').style.display = 'none';
        fill.scrollIntoView({behavior:'smooth', block:'start'});
      }
    }

    function lockFillPic(){
      alert("Answers locked. Use Reset to clear.");
    }

    function resetFillPic() {
      const container = document.getElementById('fillpic');
      const old = container.querySelector('iframe');
      if (old) {
        const fresh = old.cloneNode(true);
        old.replaceWith(fresh);
      }
    }

    function toggleReference(){
      const btn = document.getElementById('refBtn');
      const refImg = document.getElementById('ref-img');
      if(refImg.style.display === 'none'){
        refImg.style.display = 'block';
        btn.textContent = "Hide Reference";
      } else {
        refImg.style.display = 'none';
        btn.textContent = "Show Reference";
      }
    }
    
    function toggleFillTracts(){
      const box = document.getElementById('filltracts');
      const isHidden = window.getComputedStyle(box).display === 'none';
      box.style.display = isHidden ? 'block' : 'none';
      if(isHidden){
        document.getElementById('pics').style.display = 'none';
        document.getElementById('fillpic').style.display = 'none';
        box.scrollIntoView({behavior:'smooth', block:'start'});
      }
    }
  </script>


<!-- ===== Exam Bank (shuffled + timer + saved scores) ===== -->
<details open>
  <summary><b>📝 Exam Bank (interactive)</b></summary>
  <div style="margin:12px 0; padding:10px; border:1px solid #e5e7eb; border-radius:10px">
    <div style="display:flex; flex-wrap:wrap; gap:12px; align-items:center">
      <label>Mode:
        <select id="qb-mode">
          <option value="mcq">MCQ</option>
          <option value="fill">Fill-in</option>
          <option value="mix">Mixed</option>
        </select>
      </label>
      <label>Level:
        <select id="qb-level">
          <option value="ALL">All</option>
          <option value="A">A</option>
          <option value="B">B</option>
          <option value="C">C</option>
        </select>
      </label>
      <label>Number:
        <select id="qb-count">
          <option value="10">10</option>
          <option value="25" selected>25</option>
          <option value="50">50</option>
          <option value="150">All</option>
        </select>
      </label>
      <label>Timer:
        <select id="qb-timer">
          <option value="0" selected>No timer</option>
          <option value="300">5 min</option>
          <option value="600">10 min</option>
          <option value="1200">20 min</option>
          <option value="1800">30 min</option>
        </select>
      </label>
      <button id="qb-start">Start Quiz</button>
      <button id="qb-reset-best" title="Clear best score (this device only)">Reset best</button>
    </div>

    <div id="qb-status" style="margin:8px 0; color:#6b7280"></div>
    <div style="display:flex; gap:16px; align-items:center; flex-wrap:wrap">
      <div id="qb-timer-readout" style="font-weight:600; color:#111827"></div>
      <div id="qb-best" style="color:#6b7280"></div>
    </div>

    <div id="qb-area" style="margin-top:10px"></div>
  </div>
</details>

<script>
(function(){
  const area = document.getElementById('qb-area');
  const statusEl = document.getElementById('qb-status');
  const btnStart = document.getElementById('qb-start');
  const btnResetBest = document.getElementById('qb-reset-best');
  const selMode = document.getElementById('qb-mode');
  const selLevel = document.getElementById('qb-level');
  const selCount = document.getElementById('qb-count');
  const selTimer = document.getElementById('qb-timer');
  const timerReadout = document.getElementById('qb-timer-readout');
  const bestBox = document.getElementById('qb-best');

  const STORE_KEY = 'neuroexam_scores_v1';
  let BANK = [];
  let quiz = null;
  let timer = {secs:0, id:null, running:false};

  function shuffle(a){
    for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
    return a;
  }

  function shuffleOptions(q){
    const idxs = q.options.map((_,i)=>i);
    shuffle(idxs);
    const newOptions = idxs.map(i=>q.options[i]);
    const newAnswer  = idxs.indexOf(q.answer);
    return {...q, options:newOptions, answer:newAnswer};
  }

  function pickQuestions(level, count){
    let pool = (level==='ALL') ? BANK : BANK.filter(q=>q.level===level);
    pool = shuffle(pool.slice());
    if(count>pool.length) count = pool.length;
    return pool.slice(0, count).map(shuffleOptions);
  }

  function renderMCQ(q, idx){
    const opts = q.options.map((t,i)=>`
      <label style="display:block;margin:6px 0">
        <input type="radio" name="q${idx}" value="${i}"> ${String.fromCharCode(65+i)}. ${t}
      </label>`).join('');
    return `<div class="q" data-id="${q.id}" data-ans="${q.answer}">
      <div><b>Q${idx+1}.</b> ${q.stem}</div>
      <div style="margin-top:6px">${opts}</div>
    </div>`;
  }

  function renderFill(q, idx){
    return `<div class="q" data-id="${q.id}" data-ans="${q.answer}">
      <div><b>Q${idx+1}.</b> ${q.stem}</div>
      <div style="margin-top:6px">
        <input type="text" name="q${idx}" placeholder="Type the correct option text…" style="width:100%;max-width:520px">
        <div style="color:#6b7280;font-size:.9rem;margin-top:4px">Hint: match one of the options exactly (case-insensitive).</div>
      </div>
    </div>`;
  }

  function keyForBest(mode, level){ return `best_${mode}_${level}`; }
  function loadScores(){ try { return JSON.parse(localStorage.getItem(STORE_KEY)||'{}'); } catch(e){ return {}; } }
  function saveScores(obj){ localStorage.setItem(STORE_KEY, JSON.stringify(obj)); }
  function getBest(mode, level){ const s = loadScores(); return s[keyForBest(mode, level)] || null; }
  function setBest(mode, level, pct){
    const s = loadScores(); const k = keyForBest(mode, level);
    if(!s[k] || pct > s[k].pct){ s[k] = { pct, at: Date.now() }; saveScores(s); }
  }
  function resetBest(){
    const s = loadScores(); Object.keys(s).filter(k=>k.startsWith('best_')).forEach(k=>delete s[k]); saveScores(s); updateBestDisplay();
  }
  function updateBestDisplay(){
    const b = getBest(selMode.value, selLevel.value);
    bestBox.textContent = b ? `Best (${selMode.value}/${selLevel.value}): ${b.pct}%` : `Best (${selMode.value}/${selLevel.value}): —`;
  }

  function startTimer(seconds){
    stopTimer();
    if(seconds<=0){ timerReadout.textContent = ''; return; }
    timer.secs = seconds; timer.running = true;
    timerReadout.textContent = fmt(timer.secs);
    timer.id = setInterval(()=>{
      timer.secs--; timerReadout.textContent = fmt(timer.secs);
      if(timer.secs<=0){ stopTimer(); autoSubmit(); }
    }, 1000);
  }
  function stopTimer(){ if(timer.id){ clearInterval(timer.id); timer.id=null; } timer.running=false; }
  function fmt(s){ const m = Math.floor(s/60), ss = s%60; return `⏳ ${m}:${ss.toString().padStart(2,'0')}`; }

  function startQuiz(){
    const mode = selMode.value, level = selLevel.value;
    const req = parseInt(selCount.value,10);
    const sec = parseInt(selTimer.value,10);

    const qs = pickQuestions(level, req);
    quiz = { mode, level, qs, started: Date.now(), submitted:false };

    statusEl.textContent = `Loaded ${qs.length} questions (Level: ${level}, Mode: ${mode}).`;
    updateBestDisplay();

    const blocks = qs.map((q,i)=>{
      const m = (mode==='mix') ? (Math.random()<0.5?'mcq':'fill') : mode;
      return (m==='mcq') ? renderMCQ(q,i) : renderFill(q,i);
    }).join('<hr>');

    area.innerHTML = blocks + `
      <div style="margin-top:12px">
        <button id="qb-submit">Submit</button>
        <button id="qb-restart" style="margin-left:8px">Restart</button>
        <span id="qb-score" style="margin-left:12px;color:#6b7280"></span>
      </div>
    `;

    document.getElementById('qb-submit').onclick = gradeQuiz;
    document.getElementById('qb-restart').onclick = startQuiz;
    startTimer(sec);
  }

  function autoSubmit(){
    const submitBtn = document.getElementById('qb-submit');
    if(submitBtn){ submitBtn.click(); }
  }

  function gradeQuiz(){
    if(!quiz || quiz.submitted) return;
    stopTimer();
    quiz.submitted = true;

    const blocks = Array.from(area.querySelectorAll('.q'));
    let correct = 0;

    blocks.forEach((b, idx)=>{
      const ans = parseInt(b.dataset.ans,10);
      const q = quiz.qs[idx];
      const radios = b.querySelectorAll('input[type=radio]');
      const text = b.querySelector('input[type=text]');
      let ok = false;

      // clear any prior badges if user re-submits without restart
      b.querySelectorAll('.tag-correct,.tag-yours,.tag-fill').forEach(n=>n.remove());

      if(radios.length){
        const chosen = Array.from(radios).find(r=>r.checked);
        ok = chosen && parseInt(chosen.value,10)===ans;
      }else if(text){
        const want = q.options[ans].trim().toLowerCase();
        const got = (text.value||'').trim().toLowerCase();
        ok = (got===want);
      }

      // background color feedback
      b.style.background = ok ? '#ecfdf5' : '#fef2f2';
      if(ok) correct++;

      // === INLINE ANNOTATIONS ===
      if(radios.length){
        const labels = Array.from(b.querySelectorAll('label'));
        const correctLabel = labels[ans];
        if(correctLabel){
          const tag = document.createElement('span');
          tag.className = 'tag-correct';
          tag.style.marginLeft = '6px';
          tag.style.color = '#059669';
          tag.textContent = '(correct)';
          correctLabel.appendChild(tag);
        }
        const chosen = Array.from(radios).find(r=>r.checked);
        if(!ok && chosen){
          const tag = document.createElement('span');
          tag.className = 'tag-yours';
          tag.style.marginLeft = '6px';
          tag.style.color = '#b91c1c';
          tag.textContent = '(your choice)';
          chosen.closest('label')?.appendChild(tag);
        }
      } else if (text){
        const info = document.createElement('div');
        info.className = 'tag-fill';
        info.style.marginTop = '4px';
        info.style.color = ok ? '#059669' : '#b91c1c';
        info.textContent = ok ? '(correct)' : `Correct: ${q.options[ans]}`;
        b.appendChild(info);
      }
    });

    const pct = Math.round(100*correct/blocks.length);
    document.getElementById('qb-score').textContent = `Score: ${correct}/${blocks.length} (${pct}%)`;
    statusEl.textContent = `Finished. You scored ${pct}%.`;

    setBest(selMode.value, selLevel.value, pct);
    updateBestDisplay();
  }

  btnStart.onclick = startQuiz;
  btnResetBest.onclick = resetBest;

  // Load question bank
  fetch('questions.json', {cache:'no-store'})
    .then(r=>r.json())
    .then(j=>{
      BANK = j.questions || [];
      statusEl.textContent = `Question bank loaded: ${BANK.length} items. Choose options and click “Start Quiz”.`;
      updateBestDisplay();
    })
    .catch(e=>{
      statusEl.textContent = 'Failed to load questions.json: '+e.message;
    });

  [selMode, selLevel].forEach(el=>el.addEventListener('change', updateBestDisplay));
})();
</script>
